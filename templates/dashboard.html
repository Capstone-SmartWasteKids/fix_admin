{% extends "layout.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<style>
.dashboard-header {
    background: linear-gradient(135deg, #2E7D32, #66BB6A);
    color: white;
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 25px;
}

.stat-card {
    border-radius: 16px;
    padding: 20px;
    color: white;
    position: relative;
    overflow: hidden;
    transition: transform .3s, box-shadow .3s;
}

.stat-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 30px rgba(0,0,0,.2);
}

.stat-card i {
    font-size: 45px;
    opacity: .3;
    position: absolute;
    right: 20px;
    bottom: 20px;
}

.bg-users { background: linear-gradient(135deg, #42A5F5, #1E88E5); }
.bg-edu   { background: linear-gradient(135deg, #FFA726, #FB8C00); }
.bg-cat   { background: linear-gradient(135deg, #EF5350, #E53935); }
</style>

<div class="dashboard-header">
    <h3>Selamat Datang, {{ current_user.username }}</h3>
    <p class="mb-0">Dashboard Admin Smart Waste Kids</p>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="stat-card bg-users">
            <h6>Total Pengguna</h6>
            <h2>{{ total_users }}</h2>
            <i class="bi bi-people-fill"></i>
        </div>
    </div>

    <div class="col-md-4">
        <div class="stat-card bg-edu">
            <h6>Konten Edukasi</h6>
            <h2>{{ total_edukasi }}</h2>
            <i class="bi bi-book-half"></i>
        </div>
    </div>

    <div class="col-md-4">
        <div class="stat-card bg-cat">
            <h6>Kategori Sampah</h6>
            <h2>{{ total_kategori }}</h2>
            <i class="bi bi-tags-fill"></i>
        </div>
    </div>
</div>

<div class="row mt-4">

    <div class="col-md-4">
        <div class="card shadow-sm p-3">
            <h6 class="fw-bold">User Berdasarkan Role</h6>
            <canvas id="roleChart"></canvas>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm p-3">
            <h6 class="fw-bold">Sampah per Kategori</h6>
            <canvas id="sampahChart"></canvas>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card shadow-sm p-3">
            <h6 class="fw-bold">Aktivitas Admin (7 Hari)</h6>
            <canvas id="activityChart"></canvas>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const usersRole = {{ users_role | tojson }};
const sampahKategori = {{ sampah_kategori | tojson }};
const aktivitasHarian = {{ aktivitas_harian | tojson }};

window.onload = function () {

    if (document.getElementById('roleChart')) {
        new Chart(roleChart, {
            type: 'doughnut',
            data: {
                labels: usersRole.map(r => r.role),
                datasets: [{
                    data: usersRole.map(r => r.total)
                }]
            }
        });
    }

    if (document.getElementById('sampahChart')) {
        new Chart(sampahChart, {
            type: 'bar',
            data: {
                labels: sampahKategori.map(s => s.kategori),
                datasets: [{
                    data: sampahKategori.map(s => s.total)
                }]
            }
        });
    }

    if (document.getElementById('activityChart')) {
        new Chart(activityChart, {
            type: 'line',
            data: {
                labels: aktivitasHarian.map(a => a.tanggal),
                datasets: [{
                    data: aktivitasHarian.map(a => a.total)
                }]
            }
        });
    }

};
</script>
{% endblock %}